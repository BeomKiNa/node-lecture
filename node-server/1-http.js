const http = require("http");
const fs = require("fs");

const PORT = 8080;

const server = http.createServer((req, res) => {
  const { url } = req;
  res.setHeader("Content-Type", "text/html");
  // createReadStreamì„ ì‚¬ìš©í•  ê²½ìš° res.end()ë¥¼ ì‚¬ìš©í•˜ë©´ ì•ˆë˜ëŠ” ì´ìœ 

  // ìŠ¤íŠ¸ë¦¼ì€ ê¸°ë³¸ì ìœ¼ë¡œ Event Driven í˜•íƒœë¡œ êµ¬í˜„ë˜ì–´ ìžˆì–´ìš”.
  // íŒŒì¼ì„ ì½ìœ¼ë©´ì„œ ì¤‘ê°„ì¤‘ê°„ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ê³ ,  ìµœì¢…ì ìœ¼ë¡œëŠ” end ì´ë²¤íŠ¸ë¥¼ í˜¸ì¶œí•˜ê²Œ ë©ë‹ˆë‹¤. ê·¸ë¦¬ê³  res ê°ì²´ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ WriteStreamì„ ìƒì†í•˜ê³  ìžˆê³ , ì´ëŠ” end ë©”ì„œë“œë¥¼ í¬í•¨í•˜ê³  ìžˆìŠµë‹ˆë‹¤.
  // end ì´ë²¤íŠ¸ê°€ ë°œìƒí–ˆì„ë•Œ ë‚´ë¶€ì ìœ¼ë¡œ í˜¸ì¶œí•˜ëŠ” ë©”ì„œë“œê°€ res.end() ë©”ì„œë“œì™€ ë™ì¼í•˜ê¸° ë•Œë¬¸ì—,
  // ìŠ¤íŠ¸ë¦¼ì„ ì½ëŠ” ë„ì¤‘ì— end ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ ìŠ¤íŠ¸ë¦¼ì„ ì½ëŠ” ìž‘ì—…ì´ ì™„ë£Œë˜ê¸° ì „ì— ìž‘ì—…ì„ í•´ë‹¹ ëë‚´ë²„ë ¤ì„œ ì •ìƒì ì¸ ê²°ê³¼ë¥¼ ì–»ì§€ ëª»í•˜ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤.

  // pipeëŠ” ë¹„ë™ê¸°ì ì¸ í•¨ìˆ˜ ì´ë¯€ë¡œ, í˜¸ì¶œë§Œ í•´ë†“ê³  (ìž‘ì—…ì´ ëë‚˜ê¸¸ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³ ) ë‹¤ìŒ ì½”ë“œ ë¼ì¸ìœ¼ë¡œ ë„˜ì–´ê°€ì£ .
  // ê·¸ëž˜ì„œ pipingì´ ë˜ê³  ìžˆëŠ” ì¤‘ê°„ì— res.endë¥¼ í˜¸ì¶œí•˜ê²Œ ë˜ë©´ íŒŒì´í•‘ì´ ë©ˆì¶”ê²Œ ëœë‹µë‹ˆë‹¤.
  // pipeì´ ëë‚˜ë©´ ìžë™ìœ¼ë¡œ end() ì²˜ë¦¬ê°€ ë˜ë¯€ë¡œ, ìˆ˜ë™ì ìœ¼ë¡œ í˜¸ì¶œí•´ì¤„ í•„ìš”ëŠ” ì—†ì–´ìš” ðŸ™Œ

  if (url === "/") {
    fs.createReadStream("./html/home.html").pipe(res);
  } else if (url === "/detail") {
    fs.createReadStream("./html/detail.html").pipe(res);
  } else {
    fs.createReadStream("./html/404.html").pipe(res);
  }
});

server.listen(PORT, () =>
  console.log(`ðŸš€ Server listening: http://localhost:${PORT}`)
);
